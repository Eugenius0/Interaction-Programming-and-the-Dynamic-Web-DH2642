import{e as t}from"./index-6400038e.js";import{g as p}from"./filesToTest-e54ca7e1.js";import"./shim-7e3475d3.js";import"./util-004fc0f1.js";const h="",s=(await p(`/src/${h}resolvePromise.js`))?.resolvePromise;function o(l){return new Promise(function(r,e){setTimeout(r,l)})}describe("TW2.3.1 resolvePromise [test](/tw2.3.1.html)",function(){this.timeout(2e5),before(function(){s||this.skip()}),it("resolvePromise sets data after the promise resolves",async function(){let e={};s(o(10).then(function(){return 42}),e),t(e.promise,"promiseState.promise should be set").to.be.ok,t(e.data,"promiseState.data should be null initially").to.be.null,t(e.error,"promiseState.data should be null initially").to.be.null,await o(15),t(e.promise,"promiseState.promise should be set").to.be.ok,t(e.data,"promiseState.data should be set when the promise resolves").to.equal(42),t(e.error,"promiseState.error should remain null when the promise resolves").to.be.null}),it("resolvePromise sets error after the promise rejects",async function(){let e={};s(o(10).then(function(){throw 42}),e),t(e.promise,"promiseState.promise should be set").to.be.ok,t(e.data,"promiseState.data should be null initially").to.be.null,t(e.error,"promiseState.data should be null initially").to.be.null,await o(15),t(e.promise,"promiseState.promise should be set").to.be.ok,t(e.error,"promiseState.error should be set when the promise rejects").to.equal(42),t(e.data,"promiseState.data should remain null when the promise rejects ").to.be.null}),it("resolvePromise checks for null promise",async function(){let e={};t(function(){s(null,e)},"Must check whether the promise is null, as in that case it makes no sense to invoke then() or catch()").to.not.throw()}),it("resolvePromise check for race condition",async function(){const e={};function n(i){function m(){return"resolved after "+i}function u(){const a=o(i).then(m);return a.name="promiseToResolveAfter_"+i,s(a,e),a}return u}await Promise.all([o(1).then(n(100)),o(3).then(n(2))]),t(e.promise).to.be.ok,t(e.promise.name).to.be.equal("promiseToResolveAfter_2","latest promise should be set in promiseState.promise"),t(e.data).to.be.equal("resolved after 2","latest promise result should be set in promiseState.data")})});
